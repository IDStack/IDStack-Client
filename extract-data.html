<!DOCTYPE html>
<html lang="en">
<!--<![endif]-->
<!-- BEGIN HEAD -->

<head>
    <meta charset="utf-8" />
    <title>IDStack</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <meta content="IDStack | The common protocol for document verification built on Blockchain" name="description" />
    <meta content="www.idstack.one" name="author" />
    <!-- BEGIN GLOBAL MANDATORY STYLES -->
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700&subset=all" rel="stylesheet" type="text/css" />
    <link href="assets/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css" />
    <!-- END GLOBAL MANDATORY STYLES -->
    <!-- BEGIN PAGE LEVEL PLUGINS -->
    <link href="assets/global/plugins/bootstrap-datepicker/css/bootstrap-datepicker3.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/global/plugins/bootstrap-fileinput/bootstrap-fileinput.css" rel="stylesheet" type="text/css" />

    <link rel="stylesheet" href="assets/global/plugins/bootstrap-material-datetimepicker/css/bootstrap-material-datetimepicker.css" />
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,500' rel='stylesheet' type='text/css'>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- END PAGE LEVEL PLUGINS -->
    <!-- BEGIN THEME GLOBAL STYLES -->
    <link href="assets/global/css/components-md.min.css" rel="stylesheet" id="style_components" type="text/css" />
    <link href="assets/global/css/plugins-md.min.css" rel="stylesheet" type="text/css" />
    <!-- END THEME GLOBAL STYLES -->
    <!-- BEGIN THEME LAYOUT STYLES -->
    <link href="assets/layout/css/layout.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/layout/css/themes/blue.min.css" rel="stylesheet" type="text/css" id="style_color" />
    <link href="assets/layout/css/custom.min.css" rel="stylesheet" type="text/css" />
    <!-- END THEME LAYOUT STYLES -->
    <link rel="shortcut icon" href="assets/favicon.png" /> </head>
<!-- END HEAD -->

<body class="page-header-fixed page-sidebar-closed-hide-logo page-container-bg-solid page-sidebar-closed page-md">
<!-- BEGIN HEADER -->
<div id="header"></div>
<!-- END HEADER -->
<!-- BEGIN HEADER & CONTENT DIVIDER -->
<div class="clearfix"> </div>
<!-- END HEADER & CONTENT DIVIDER -->
<!-- BEGIN CONTAINER -->
<div class="page-container">
    <!-- BEGIN SIDEBAR -->
    <div id="sidebar"></div>
    <!-- END SIDEBAR -->
    <!-- BEGIN CONTENT -->
    <div class="page-content-wrapper">
        <!-- BEGIN CONTENT BODY -->
        <div class="page-content">
            <!-- BEGIN PAGE HEAD-->
            <div class="page-head">
                <!-- BEGIN PAGE TITLE -->
                <div class="page-title">
                    <h3>Data Extraction
                        <small> extract data from document in order to make it into machine readable format</small>
                    </h3>
                </div>
                <!-- END PAGE TITLE -->
            </div>
            <!-- END PAGE HEAD-->
            <!-- BEGIN PAGE BASE CONTENT -->
            <div class="row">
                <div class="col-md-6">
                    <div class="tabbable-line boxless tabbable-reversed">
                        <ul class="nav nav-tabs" >
                            <li class="active">
                                <a href="#tab_0" data-toggle="tab" id="tab_template"> </a>
                            </li>



                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane active" id="tab_0">
                                <div class="portlet light portlet-fit portlet-form ">
                                    <div class="portlet-body">
                                        <!-- BEGIN CONTENT FORM-->
                                        <div id="form_template"></div>

                                        <!-- END CONTENT FORM-->
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane" id="tab_1">
                                <div class="portlet light portlet-fit portlet-form ">
                                    <div class="portlet-title">

                                        <div class="actions">
                                            <a class="btn btn-circle btn-icon-only btn-default" href="javascript:;">
                                                <i class="icon-cloud-upload"></i>
                                            </a>
                                            <a class="btn btn-circle btn-icon-only btn-default" href="javascript:;">
                                                <i class="icon-wrench"></i>
                                            </a>
                                            <a class="btn btn-circle btn-icon-only btn-default" href="javascript:;">
                                                <i class="icon-trash"></i>
                                            </a>
                                        </div>
                                    </div>
                                    <div class="portlet-body">
                                        <!-- BEGIN FORM-->

                                        <!-- END FORM-->
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane" id="tab_2">

                            </div>
                            <div class="tab-pane" id="tab_3">
                                <div class="portlet light ">
                                    <div class="portlet-title">
                                        <div class="tools">
                                            <a href="javascript:;" class="collapse"> </a>
                                            <a href="#portlet-config" data-toggle="modal" class="config"> </a>
                                            <a href="javascript:;" class="reload"> </a>
                                            <a href="javascript:;" class="remove"> </a>
                                        </div>
                                    </div>
                                    <div class="portlet-body form">
                                        <div class="form-body">
                                            <div class="form-group">
                                                <form action="#" class="mt-repeater form-horizontal">
                                                    <div data-repeater-list="group-a">
                                                        <div data-repeater-item class="mt-repeater-item">
                                                            <!-- jQuery Repeater Container -->
                                                            <div class="mt-repeater-input">
                                                                <label class="control-label">Label Name</label>
                                                                <br/>
                                                                <input type="text" name="text-input" class="form-control"/>
                                                            </div>
                                                            <div class="mt-repeater-input">
                                                                <label class="control-label">Data Type</label>
                                                                <br/>
                                                                <select name="select-input" class="form-control">
                                                                    <option value="A" selected>Text</option>
                                                                    <option value="B">Date</option>
                                                                </select>
                                                            </div>
                                                            <div class="mt-repeater-input">
                                                                <label class="control-label">Value</label>
                                                                <br/>
                                                                <input type="text" name="text-input" class="form-control"/>
                                                            </div>
                                                            <div class="mt-repeater-input">
                                                                <a href="javascript:;" data-repeater-delete class="btn btn-danger mt-repeater-delete">
                                                                    <i class="fa fa-close"></i> Delete</a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <a href="javascript:;" data-repeater-create class="btn btn-success mt-repeater-add">
                                                        <i class="fa fa-plus"></i> Add</a>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- BEGIN Verify FORM PORTLET-->
                    <div class="portlet light ">
                        <div class="portlet-title">
                            <div class="caption">
                                <i class="icon-settings"></i>
                                <span class="caption-subject bold uppercase"> Validate Document</span>
                            </div>
                        </div>
                        <div class="portlet-body form">
                            <form role="form">
                                <div class="form-body">

                                    <div class="form-group">
                                        <label class="control-label col-md-3">Public Certificate File</label>
                                        <div class="col-md-9">
                                            <div class="fileinput fileinput-new" data-provides="fileinput">
                                                        <span class="btn green btn-file">
                                                            <span class="fileinput-new"> File </span>
                                                            <span class="fileinput-exists"> Change </span>
                                                            <input type="file" name="..."  id="CertFileInput" onchange=loadContent()>
                                                        </span>
                                                <span class="fileinput-filename"> </span> &nbsp;
                                                <a href="javascript:;" class="close fileinput-exists" data-dismiss="fileinput"> </a>

                                            </div>
                                        </div>
                                    </div>

                                    <div class="row" >
                                        <div class="col-md-12">
                                            <p> </p>
                                        </div>

                                    </div>

                                    <div class="form-group">
                                        <label class="control-label col-md-3">Private Key File</label>
                                        <div class="col-md-9">
                                            <div class="fileinput fileinput-new" data-provides="fileinput">
                                                        <span class="btn green btn-file">
                                                            <span class="fileinput-new"> File </span>
                                                            <span class="fileinput-exists"> Change </span>
                                                            <input type="file" name="..." id="PvtFileInput" onchange=loadContent()>
                                                        </span>
                                                <span class="fileinput-filename"> </span> &nbsp;
                                                <a href="javascript:;" class="close fileinput-exists" data-dismiss="fileinput"> </a>

                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group form-md-line-input">
                                        <label for="certificate_pass" class="col-md-2 control-label">Password</label>
                                        <div class="col-md-4">
                                            <input type="password" class="form-control" id="certificate_pass" placeholder="Password">
                                            <div class="form-control-focus"> </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-actions right">
                                    <button type="reset" class="btn default">Reset</button>
                                    <button type="button" class="btn green" onclick="submitValidatedPassport();">Validate and Save</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    <!-- END Verify FORM PORTLET-->

                </div>

                <div class="col-md-6" >
                    <!--<iframe class="col-md-6" src="assets/global/plugins/pdfjs/web/viewer.html?file=../../../../../doc_templates/temp-passport.pdf" style="width:620px; height:500px;" allowfullscreen frameborder="0">-->
                        <!--This browser does not support PDFs. Please download the PDF to view it: <a href="http://www.orimi.com/pdf-test.pdf">Download PDF</a>-->
                    <!--</iframe>-->
                    <object id="pdf_viewer" width="620px" height="500px" data="" onerror=errorInPdfViewer()>
                    </object>

                    <!--<iframe src="http://docs.google.com/gview?url=http://www.orimi.com/pdf-test.pdf&embedded=true"-->
                            <!--style="width:600px; height:500px;" frameborder="0"></iframe>-->

                </div>


            </div>



        </div>
    </div>
    <!-- END CONTENT -->
</div>
<!-- END CONTAINER -->

<!-- Start wrapper for jquery script imports  -->
<script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>

<script type="text/javascript" src="assets/global/plugins/jquery.min.js"></script>

<!-- End wrapper for jquery script imports -->
<script>if (window.module) module = window.module;</script>

<script>
    var url ;
    var docType;
    var formObject ;

    $(function(){
        App.startPageLoading({
            animate: true
        });
        // Load header and sidebar into DOM dynamically
        $("#header").load("layout/header.html");
        $("#sidebar").load("layout/sidebar.html");
        $('.datePicker').bootstrapMaterialDatePicker({
            time:false,
            clearButton: true
        });
        url = getUrlParameter("url");
        docType= getUrlParameter("doctype");
        if (docType || 0 !== docType.length) {
            $("#tab_template").append(stringBeautify(docType));

            $("#form_template").load("doc_templates/extract/" + docType + ".html");

            setTimeout(function () {
                formObject = $("form#form_extract_" + docType);
                formObject.loadJSON(response);
                App.stopPageLoading();
            }, 1000);
        }
        else {
            App.stopPageLoading();
            console.log("define docType uri parameter");
        }



        switch(getUrlParameter("resource")) {
            case "pdf":
                showPDFbyFile();
                break;
            case "url":
                showPDFbyURL();
                break;
            default:

        }


    });



    function showPDFbyFile(){



    }
    function showPDFbyURL() {

        document.getElementById("pdf_viewer").data = url
        $("#pdf_viewer").append(url);
    }

    function loadFile() {


        var input, file, fr;

        if (typeof window.FileReader !== 'function') {
            alert("The file API isn't supported on this browser yet.");
            return;
        }

        input = document.getElementById('fileInput');
        console.log(input.files[0]);
        if (!input) {
            alert("Um, couldn't find the fileinput element.");
        }
        else if (!input.files) {
            alert("This browser doesn't seem to support the `files` property of file inputs.");
        }
        else if (!input.files[0]) {
            alert("Please select a file before clicking 'Load'");
        }
        else {
            file = input.files[0];
            fr = new FileReader();

        }


        $('form#form_passport').loadJSON(response);




    }
    function submitValidatedPassport() {
        json_doc= extractContent();
        validated_json_doc=validateContent(json_doc);
        saveJsonFile(validated_json_doc);
    }

    function submitPassport() {
        json_doc= extractContent();
        saveJsonFile(json_doc);
    }


    function extractContent() {
        var unindexed_array = formObject.serializeArray();

        var indexed_array = {};

        $.map(unindexed_array, function(n, i){
            indexed_array[n['name']] = n['value'];

        });

        // Should handle inner arrays
//        indexed_array.name={
//            'surname' : indexed_array.surname,
//            'other_names' :indexed_array.other_names
//        }
//
//        delete indexed_array.surname;
//        delete indexed_array.other_names;


        passportJsonTemplate.content =indexed_array;

        return passportJsonTemplate;


    }
    function validateContent(json_doc) {

        signature= getSignature();
        json_doc.verifier= {
            "id": signature.id,
            "signature": signature.content
        }
        return json_doc;
    }

    function saveJsonFile(json_doc) {
        var json_stringify_doc =JSON.stringify(json_doc,0,4);
        var file = new File([json_stringify_doc], "IDStack-extracted-doc.json", {type: "text/json;charset=utf-8"});
        saveAs(file);
    }

    function stringBeautify(string) {
        string = string.charAt(0).toUpperCase() + string.slice(1);
        string = string.replace(/_/g, " ");
        return string;
    }




    function errorInPdfViewer() {
        console.log("Enter a valid url or file for resource pdf");
        $("#pdf_viewer").append("Enter a valid url or file for resource pdf");
    }
    // Webservice calls
    function getSignature() {
        var signature = {
            "id": "sdfsd343",
            "signature": {}
        };
        return signature
    }


</script>

<!-- BEGIN CORE PLUGINS -->

<script src="assets/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/js.cookie.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>
<!-- END CORE PLUGINS -->
<!-- BEGIN PAGE LEVEL PLUGINS -->
<script type="text/javascript" src="assets/global/plugins/moment.min.js"></script>
<script type="text/javascript" src="assets/global/plugins/bootstrap-material-datetimepicker/js/bootstrap-material-datetimepicker.js"></script>
<script type="text/javascript" src="assets/global/plugins/filesaverjs/filesaver.min.js"></script>
<script src="assets/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/bootstrap-fileinput/bootstrap-fileinput.js" type="text/javascript"></script>
<script src="https://cdn.rawgit.com/kevindb/jquery-load-json/v1.3.3/dist/jquery.loadJSON.min.js" integrity="sha384-fG4z44FEBJnIevyzvSDobSmVTsO/oVsxNvKcUl7bO1ihWYDPg2QI83Xi+7wSBzap" crossorigin="anonymous"></script>
<script src="assets/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>



<!-- END PAGE LEVEL PLUGINS -->
<!-- BEGIN THEME GLOBAL SCRIPTS -->
<script src="assets/global/scripts/app.min.js" type="text/javascript"></script>
<!-- END THEME GLOBAL SCRIPTS -->
<!-- BEGIN PAGE LEVEL SCRIPTS -->
<script src="doc_templates/json/idstack-passport.js" type="text/javascript"></script>
<script src="doc_templates/json/dummy-docparser-response.js" type="text/javascript"></script>
<script src="assets/custom/scripts/url-paser.js" type="text/javascript" ></script>

<!-- END PAGE LEVEL SCRIPTS -->
<!-- BEGIN THEME LAYOUT SCRIPTS -->
<script src="assets/layout/scripts/layout.min.js" type="text/javascript"></script>
<script src="assets/layout/scripts/demo.min.js" type="text/javascript"></script>
<script src="assets/layout/global/scripts/quick-sidebar.min.js" type="text/javascript"></script>
<script src="assets/layout/global/scripts/quick-nav.min.js" type="text/javascript"></script>
<!-- END THEME LAYOUT SCRIPTS -->



</body>

</html>

